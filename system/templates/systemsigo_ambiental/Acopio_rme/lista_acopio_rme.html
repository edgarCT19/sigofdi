{% extends "systemsigo/base.html" %}
{% load static %}

{% block content %}
<div>
  <div class="card">
    <!-- Search + Botón Agregar -->
    <div class="d-flex justify-content-end align-items-center mt-2 mb-3 p-2 mx-1">
      <div class="searchBox position-relative d-flex align-items-center mx-2">
        <i class="bi bi-search me-2 text-secondary"></i>
        <input
          type="text"
          id="input-search"
          placeholder="Buscar..."
          oninput="toggleClearButton(this)"
        />
        <button
          id="clear-search"
          type="button"
          class="btn btn-sm btn-link text-secondary px-2 d-none"
          onclick="clearSearch()"
          title="Borrar búsqueda"
        >
          <i class="bi bi-x-circle-fill"></i>
        </button>
      </div>

      <a href="{% url 'centro_acopio_rme_crear_admin' %}">
        <button class="btn btn-primary">Agregar</button>
      </a>
    </div>

    <!-- Tabla -->
    <div class="d-flex align-items-center justify-content-center">
      <div class="table-container">
        <table class="styled-table text-center">
          <thead>
            <tr class="text-center">
              <th colspan="11" class="table-title"
                  style="background-color: var(--color-uacam-table-header); font-size: 15px;">
                Lista de Centros de Acopio RME
              </th>
            </tr>
            <tr class="text-center">
              <th>Campus</th>
              <th>Unidad Responsable</th>
              <th>Centro de Acopio</th>
              <th>Tipo de Residuo</th>
              <th>Cantidad</th>
              <th>Estado Físico</th>
              <th>Fecha Registro</th>
              <th>Creado por</th>
              <th>Última actualización</th>
              <th>Actualizado por</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="table-body">
            {% for acopio in acopios %}
            <tr>
              <td>{{ acopio.unidad_responsable.campus.nomenclatura }}</td>
              <td>{{ acopio.unidad_responsable.nombre }}</td>
              <td>{{ acopio.centro_acopio }}</td>
              <td>{{ acopio.tipo_residuo }}</td>
              <td>{{ acopio.cantidad }}</td>
              <td>{{ acopio.estado_fisico }}</td>
              <td>{{ acopio.fecha_registro|date:"Y-m-d H:i:s" }}</td>
              <td>{{ acopio.creado_por }}</td>
              <td>{{ acopio.ultima_actualizacion|date:"Y-m-d H:i:s" }}</td>
              <td>{{ acopio.actualizado_por }}</td>
              <td>
                <div class="d-flex actions justify-content-center gap-2">
                  <a href="{% url 'centro_acopio_rme_editar_admin' acopio.id %}"
                     class="btn btn-light rounded-circle btn-sm"
                     title="Editar">
                    <i class="bi bi-pencil"></i>
                  </a>
                  <button class="btn btn-danger btn-sm rounded-circle"
                          onclick="eliminarAcopio('{{ acopio.id }}', '{{ acopio.centro_acopio }}')"
                          title="Eliminar">
                    <i class="bi bi-trash"></i>
                  </button>
                  <form id="form-eliminar-{{ acopio.id }}" action="{% url 'centro_acopio_rme_eliminar_admin' acopio.id %}" method="POST" style="display:none;">
                    {% csrf_token %}
                  </form>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="11" class="text-center">No hay registros disponibles</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Paginación -->
    <div class="table-header d-flex justify-content-end align-items-center mt-2 mb-3 p-2">
      <ul class="pagination" id="pagination"></ul>
    </div>
  </div>
</div>

<script>
// SweetAlert para eliminar registros
function eliminarAcopio(acopioId, nombre) {
  Swal.fire({
    title: '¿Estás seguro?',
    text: `El centro de acopio "${nombre}" será eliminado`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#6c757d',
    confirmButtonText: 'Sí, eliminar',
    cancelButtonText: 'Cancelar'
  }).then((result) => {
    if (result.isConfirmed) {
      Swal.fire({
        title: '¡Eliminado!',
        text: `El centro de acopio "${nombre}" fue eliminado correctamente.`,
        icon: 'success',
        confirmButtonText: 'OK'
      }).then(() => {
        document.getElementById(`form-eliminar-${acopioId}`).submit();
      });
    }
  });
}
</script>

{% endblock content %}